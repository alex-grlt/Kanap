<!DOCTYPE html>
<html lang="fr">

<head>
  <title>Cart</title>

  <meta charset="utf-8">
  <meta name="description" content="Plateforme incroyable de e-commerce">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link href="../css/style.css" rel="stylesheet" />
  <link href="../css/cart.css" rel="stylesheet" />

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  <header>
    <div class="limitedWidthBlockContainer informations">
      <div class="limitedWidthBlock">
        <ul>
          <li><img src="../images/icons/phone.svg" alt="logo de téléphone" class="informations__phone">01 23 45 67 89
          </li>
          <li><img src="../images/icons/mail.svg" alt="logo d'une enveloppe" class="informations__mail">support@name.com
          </li>
          <li><img src="../images/icons/adress.svg" alt="logo d'un point de géolocalisation"
              class="informations__address">01 23 45 67 89</li>
        </ul>
      </div>
    </div>
    <div class="limitedWidthBlockContainer menu">
      <div class="limitedWidthBlock">
        <a href="./index.html">
          <img class="logo" src="../images/logo.png" alt="Logo de l'entreprise">
        </a>
        <nav>
          <ul>
            <a href="./index.html">
              <li>Accueil</li>
            </a>
            <a href="./cart.html">
              <li>Panier</li>
            </a>
          </ul>
        </nav>
      </div>
    </div>
    <img class="banniere" src="../images/banniere.png" alt="Baniere">
  </header>

  <main class="limitedWidthBlockContainer">
    <div class="limitedWidthBlock" id="limitedWidthBlock">
      <div class="cartAndFormContainer" id="cartAndFormContainer">
        <h1>Votre panier</h1>
        <section class="cart">
          <section id="cart__items">
            <!--  <article class="cart__item" data-id="{product-ID}" data-color="{product-color}">
                <div class="cart__item__img">
                  <img src="../images/product01.jpg" alt="Photographie d'un canapé">
                </div>
                <div class="cart__item__content">
                  <div class="cart__item__content__description">
                    <h2>Nom du produit</h2>
                    <p>Vert</p>
                    <p>42,00 €</p>
                  </div>
                  <div class="cart__item__content__settings">
                    <div class="cart__item__content__settings__quantity">
                      <p>Qté : </p>
                      <input type="number" class="itemQuantity" name="itemQuantity" min="1" max="100" value="42">
                    </div>
                    <div class="cart__item__content__settings__delete">
                      <p class="deleteItem">Supprimer</p>
                    </div>
                  </div>
                </div>
              </article> -->
          </section>
          <div class="cart__price">
            <p>Total (<span id="totalQuantity">
                <!-- 2 --></span> articles) : <span id="totalPrice">
                <!-- 84,00 --></span> €</p>
          </div>
          <div class="cart__order">
            <form method="get" class="cart__order__form">
              <div class="cart__order__form__question">
                <label for="firstName">Prénom: </label>
                <input type="text" name="firstName" id="firstName" required>
                <p id="firstNameErrorMsg">
                  <!-- ci est un message d'erreur -->
                </p>
              </div>
              <div class="cart__order__form__question">
                <label for="lastName">Nom: </label>
                <input type="text" name="lastName" id="lastName" required>
                <p id="lastNameErrorMsg"></p>
              </div>
              <div class="cart__order__form__question">
                <label for="address">Adresse: </label>
                <input type="text" name="address" id="address" required>
                <p id="addressErrorMsg"></p>
              </div>
              <div class="cart__order__form__question">
                <label for="city">Ville: </label>
                <input type="text" name="city" id="city" required>
                <p id="cityErrorMsg"></p>
              </div>
              <div class="cart__order__form__question">
                <label for="email">Email: </label>
                <input type="email" name="email" id="email" required>
                <p id="emailErrorMsg"></p>
              </div>
              <div class="cart__order__form__submit">
                <input type="" value="Commander !" id="order">
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer>
    <div class="limitedWidthBlockContainer footerMain">
      <div class="limitedWidthBlock">
        <div>
          <img class="logo" src="../images/logo.png" alt="Logo de l'entreprise">
        </div>
        <div>
          <p>10 quai de la charente <br>75019 Paris 19</p>
        </div>
        <div>
          <p>Téléphone : 01 23 45 67 89</p>
        </div>
        <div>
          <p>Email : support@name.com</p>
        </div>
      </div>
    </div>
    <div class="limitedWidthBlockContainer footerSecondary">
      <div class="limitedWidthBlock">
        <p>© Copyright 2021 - 2042 | Openclassrooms by Openclassrooms | All Rights Reserved | Powered by <3</p> </div>
            </div> </footer> <script src="../js/product.js">
            </script>

            <script>
              let total = 0

              async function retrieveBasket() {
                for (canap of getBasket()) {
                  let reponse = await fetch("http://localhost:3000/api/products/" + canap.id)
                  let data = await reponse.json()

                  const article = document.createElement("article")
                  const div1 = document.createElement("div")
                  const div2 = document.createElement("div")
                  const div3 = document.createElement("div")
                  const div4 = document.createElement("div")
                  const div5 = document.createElement("div")
                  const div6 = document.createElement("div")
                  const img = document.createElement("img")
                  const h2 = document.createElement("h2")
                  const p1 = document.createElement("p")
                  const p2 = document.createElement("p")
                  const p3 = document.createElement("p")
                  const p4 = document.createElement("p")
                  const input = document.createElement("input")

                  cart__items.appendChild(article)
                  article.appendChild(div1)
                  div1.appendChild(img)

                  article.className = "cart__item"


                  article.setAttribute("data-id", canap.id)
                  article.setAttribute("data-color", canap.option)

                  div1.className = "cart__item__img"

                  img.src = data.imageUrl
                  h2.innerHTML = data.name
                  p1.innerHTML = canap.option
                  p2.innerHTML = data.price + " €"


                  img.alt = "Photographie d'un canapé"

                  article.appendChild(div2)
                  div2.className = "cart__item__content"

                  div2.appendChild(div3)
                  div3.className = "cart__item__content__description"

                  div3.appendChild(h2)
                  div3.appendChild(p1)
                  div3.appendChild(p2)

                  div2.appendChild(div4)
                  div4.className = "cart__item__content__settings"

                  div4.appendChild(div5)
                  div5.className = "cart__item__content__settings__quantity"
                  div5.appendChild(p3)
                  p3.innerHTML = "Quantité : "

                  div5.appendChild(input)
                  input.type = "number"
                  input.className = "itemQuantity"
                  input.name = "itemQuantity"
                  input.min = "1"
                  input.max = "100"
                  input.value = canap.quantity

                  div4.appendChild(div6)
                  div6.className = "cart__item__content__settings__delete"
                  div6.appendChild(p4)
                  p4.className = "deleteItem"
                  p4.innerHTML = "Supprimer"

                  totalQuantity.innerHTML = getNumberProduct()

                  p4.addEventListener("click", function (evt) {
                    let canapID = article.getAttribute('data-id')
                    let canapOption = article.getAttribute('data-color')

                    removeFromBasket(canapID, canapOption)
                    location.reload();
                  })

                  total += canap.quantity * data.price
                  totalPrice.innerHTML = total
                }

              }

              order.addEventListener("click", async function (evt) {
                let prenom = document.getElementById("firstName").value
                let nom = document.getElementById("lastName").value
                let addresse = document.getElementById("address").value
                let ville = document.getElementById("city").value
                let email = document.getElementById("email").value

                if (/^[^0-9][A-Z]*[a-z]*$/.test(prenom) == false) {
                  (document.getElementById("firstNameErrorMsg")).innerHTML = "Ceci est un message d'erreur"
                } else {
                  (document.getElementById("firstNameErrorMsg")).innerHTML = ""

                  if (/^[^0-9][A-Z]*[a-z]*$/.test(nom) == false) {
                    (document.getElementById("lastNameErrorMsg")).innerHTML = "Ceci est un message d'erreur"
                  } else {
                    (document.getElementById("lastNameErrorMsg")).innerHTML = ""
                    if (/.*\S.*/.test(addresse) == false) {
                      (document.getElementById("addressErrorMsg")).innerHTML =
                        "Ceci est un message d'erreur"
                    } else {
                      (document.getElementById("addressErrorMsg")).innerHTML = ""
                      if (/.*\S.*/.test(addresse) == false) {
                        (document.getElementById("addressErrorMsg")).innerHTML =
                          "Ceci est un message d'erreur"
                      } else {
                        (document.getElementById("addressErrorMsg")).innerHTML = ""
                        if (/.*\S.*/.test(addresse) == false) {
                          (document.getElementById("addressErrorMsg")).innerHTML =
                            "Ceci est un message d'erreur"
                        } else {
                          (document.getElementById("addressErrorMsg")).innerHTML = ""
                          if (/^[^0-9][A-Z]*[a-z]*$/.test(ville) == false) {
                            (document.getElementById("cityErrorMsg")).innerHTML =
                              "Ceci est un message d'erreur"
                          } else {
                            (document.getElementById("cityErrorMsg")).innerHTML = ""
                            if (/^[^0-9][A-Z]*[a-z]*$/.test(ville) == false) {
                              (document.getElementById("cityErrorMsg")).innerHTML =
                                "Ceci est un message d'erreur"
                            } else {
                              (document.getElementById("cityErrorMsg")).innerHTML = ""
                              if (/^[^0-9][A-Z]*[a-z]*$/.test(ville) == false) {
                                (document.getElementById("cityErrorMsg")).innerHTML =
                                  "Ceci est un message d'erreur"
                              } else {
                                (document.getElementById("cityErrorMsg")).innerHTML = ""
                                if (/^[^0-9][A-Z]*[a-z]*$/.test(ville) == false) {
                                  (document.getElementById("cityErrorMsg")).innerHTML =
                                    "Ceci est un message d'erreur"
                                } else {
                                  (document.getElementById("cityErrorMsg")).innerHTML = ""
                                  if (
                                    /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                                    .test(email) == false) {
                                    (document.getElementById("emailErrorMsg")).innerHTML =
                                      "Ceci est un message d'erreur"
                                  } else {
                                    (document.getElementById("emailErrorMsg")).innerHTML = ""

                                    let result = await fetch("http://localhost:3000/api/products/order", {
                                        method: "POST",
                                        headers: {
                                          'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                          contact: {
                                            prenom: prenom,
                                            nom: nom,
                                            addresse: addresse,
                                            ville: ville,
                                            email: email
                                          },
                                          basket: getBasket()
                                        })
                                      })

                                      let data = await result.json()
                                      console.log(data)
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              })






              retrieveBasket()
            </script>
</body>

</html>